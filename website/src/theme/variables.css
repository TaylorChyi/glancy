:root {
  --bar-height: 60px;
  --radius-sm: 4px;
  --radius-md: 8px;
  --radius-lg: 12px;
  --radius-xl: 20px;
  --radius-avatar: 12px;
  --color-bg: #0f1115;
  --color-surface: #15181e;
  --color-panel: #1c2027;
  --color-panel-subtle: #111417;
  --color-border-strong: #2a2f3a;
  --color-text-primary: #e8ecf2;
  --color-text-muted: #9aa3af;
  --color-text-placeholder: #98a2b3;
  --color-accent: #7aa2ff;
  --shadow-elevated-md: 0 16px 40px rgb(0 0 0 / 45%);
  --shadow-elevated-lg: 0 20px 56px rgb(0 0 0 / 45%);

  /* search box vertical padding */
  --search-box-padding-y: 12px;
  --btn-padding: 0.6em 1.2em;
  --btn-border: 1px solid transparent;
  --user-menu-width: 180px;
  --z-index-popover: 1100;

  /* sidebar layout tokens */
  --sidebar-w: 240px;
  --sidebar-radius: 10px;
  --sidebar-item-h: 36px;
  --sidebar-pad-x: 16px;
  --sidebar-pad-y: 12px;
  --sidebar-gap-row: 8px;
  --sidebar-gap-section: 12px;
  --sidebar-icon-size: 18px;
  --sidebar-accent: #96a0ff;
  --sidebar-item-gap: 12px;

  /* popover metrics */
  --popover-w: 304px;
  --popover-radius: 14px;
  --sec-hd-size: 12px;
  --sec-hd-weight: 600;
  --item-size: 14px;
  --item-weight: 400;

  /* search bar tokens */
  --sb-surface: #0e1116;
  --sb-inner: #11161e;
  --sb-seg: #141b24;
  --sb-stroke: rgb(255 255 255 / 6%);
  --sb-divider: rgb(255 255 255 / 10%);
  --sb-text: #edeff2;
  --sb-muted: #9fa7b3;
  --sb-icon: #edeff2;
  --sb-action-icon: var(--sb-icon);
  --sb-cta: #fff;
  --sb-cta-icon: #0e1116;
  --sb-voice-color: var(--sb-icon);

  /*
   * search bar 在桌面稿中的最大内容宽度，统一复用布局主内容宽度令牌，
   * 以避免 SearchBox 与 Layout 各自维护独立基准导致的双维护风险。
   */
  --sb-max-width: var(--layout-content-max, 960px);
  --sb-h: 56px;
  --sb-r: 28px;
  --sb-radius: var(--sb-r);
  --sb-pad-x: 20px;
  --sb-pad-x-compact: 12px;
  --sb-gap: 16px;
  --sb-divider-w: 1px;
  --sb-border: var(--sb-stroke);
  --sb-border-active: color-mix(in srgb, var(--sb-stroke) 60%, white 40%);
  --sb-bg: var(--sidebar-panel, var(--sb-surface));
  --sb-bg-hover: var(
    --sidebar-hover-bg,
    color-mix(in srgb, var(--sidebar-panel, var(--sb-surface)) 94%, white 6%)
  );
  --sb-panel: var(--sb-inner);
  --sb-panel-strong: color-mix(in srgb, var(--sb-inner) 88%, black 12%);
  --sb-inner-highlight: rgb(255 255 255 / 12%);
  --sb-ring: 0 0 0 2px rgb(255 255 255 / 8%);
  --sb-shadow: 0 6px 20px rgb(0 0 0 / 25%);
  --sb-shadow-soft: 0 4px 16px rgb(0 0 0 / 22%);
  --sb-menu-shadow: 0 18px 44px rgb(0 0 0 / 45%);
  --sb-font: 16px;
  --sb-font-sm: 15px;
  --sb-font-strong: 600;
  --sb-font-weight: 500;
  --sb-body-letter-spacing: 0.01em;
  --sb-code-letter-spacing: 0.08em;
  --sb-code-min-width: 64px;
  --sb-menu-width: 360px;
  --sb-menu-max-h: 420px;
  --sb-menu-radius: 16px;
  --sb-menu-padding: 8px;
  --sb-icon-size-sm: 18px;
  --sb-icon-size-lg: 20px;
  --sb-action-size-sm: 40px;
  --sb-action-size-lg: 44px;
  --sb-icon-size: var(--sb-icon-size-lg);
  --sb-action-size: var(--sb-action-size-lg);
  --sb-caret: #99a6b5;
  --chip-gap: 8px;
  --chip-radius: 16px;
  --chip-bg: #252b33;
  --chip-bg-hover: #2b323c;
  --chip-text: #d5dbe6;
  --divider-color: var(--sb-divider);
  --menu-bg: var(--sb-bg, var(--sb-inner));
  --menu-border: color-mix(in srgb, var(--sb-stroke) 80%, black 20%);
  --menu-hover: color-mix(in srgb, var(--menu-bg) 88%, white 12%);
  --menu-code-color: #f1f4f8;
  --menu-name-color: #c6ccd7;
  --menu-check-color: #d9dee7;
  --menu-scroll-track: color-mix(in srgb, var(--menu-bg) 70%, transparent);
  --menu-scroll-thumb: color-mix(in srgb, var(--menu-bg) 20%, white 12%);
  --menu-scroll-thumb-hover: color-mix(
    in srgb,
    var(--menu-scroll-thumb) 70%,
    white 30%
  );
  --direction-icon: #b8c2cf;
  --text-primary: var(--sb-text);
  --text-muted: var(--sb-muted);
  --sb-scroll-track: color-mix(in srgb, var(--sb-inner) 35%, transparent);
  --sb-scroll-thumb: color-mix(in srgb, var(--sb-inner) 65%, transparent);
  --sb-send-bg: rgb(255 255 255 / 92%);
  --sb-send-color: #0b0d11;
  --sb-ring-width: 2px;
  --seg-h: 44px;
  --seg-r: 22px;
  --seg-pad-x: 20px;
  --seg-arrow-gap: 12px;
  --seg-font-size: 14px;
  --seg-font-weight: 600;
  --seg-letter-space: 0.04em;
  --ph-size: 16px;
  --ph-weight: 500;
  --btn-eq: 36px;
  --btn-rec: 44px;
  --btn-gap: 12px;
  --ring-focus: 0 0 0 2px rgb(255 255 255 / 8%);
  --sb-cta-shadow: 0 10px 30px rgb(0 0 0 / 30%);
  --sb-cta-shadow-hover: 0 12px 32px rgb(0 0 0 / 32%);

  /* settings dialog */
  --settings-dialog-width-md: 640px;
  --settings-dialog-width-lg: 720px;
  --settings-dialog-max-height: 72vh;
  --settings-dialog-surface: #fff;
  --settings-dialog-surface-muted: #f2f4f7;
  --settings-dialog-background: #f7f7f8;
  --settings-dialog-border: #e5e7eb;
  --settings-dialog-text: #0b1220;
  --settings-dialog-muted: #667085;
  --settings-dialog-accent: #3b82f6;
  --settings-dialog-shadow:
    0 12px 30px rgb(11 18 32 / 12%), 0 2px 8px rgb(11 18 32 / 6%);
  --settings-dialog-radius: 16px;
  --settings-dialog-control-radius: 12px;
  --settings-dialog-control-height: 40px;
  --settings-dialog-navigation-width: 240px;
  --settings-dialog-gap-sm: 16px;
  --settings-dialog-gap-md: 24px;
}

/*
 * 背景：
 *  - SearchBox 相关 token 仅提供深色值，导致 system/light 模式下出现对比不足。
 * 目的：
 *  - 基于全局语义色（如 --color-surface-alt、--border-color、--color-text 等）映射出浅色配方，
 *    并为 system + 深色媒体恢复原有暗色实现，保持主题切换一致性。
 * 关键决策与取舍：
 *  - 通过 data-theme 派生不同 token，而非在组件中硬编码逻辑，确保扩展新主题时只需增量映射；
 *  - `.dark` 覆写块沿用 orchestrator 既有 class 机制，避免破坏 Tailwind dark 兼容链路。
 * 影响范围：
 *  - SearchBox、ChatInput、DictionaryActionPanel 等消费 `--sb-*` 的组件。
 * 演进与TODO：
 *  - 后续若引入高对比主题，可复用此结构按需新增映射，或提炼为 CSS 自定义层。
 */
:root[data-theme="light"] {
  --sb-surface: color-mix(in srgb, var(--color-surface-alt) 92%, white 8%);
  --sb-inner: color-mix(in srgb, var(--color-surface-alt) 88%, white 12%);
  --sb-seg: color-mix(
    in srgb,
    var(--color-surface-alt) 82%,
    var(--color-text) 18%
  );
  --sb-stroke: color-mix(in srgb, var(--border-color) 85%, transparent 15%);
  --sb-divider: color-mix(in srgb, var(--border-color) 70%, transparent 30%);
  --sb-text: var(--color-text);
  --sb-muted: color-mix(in srgb, var(--color-text) 58%, transparent 42%);
  --sb-icon: var(--color-text);
  /*
   * 交互背景：轻量主题下沿用白色系 CTA 壳体，避免深色按钮在浅底部产生突兀对比。
   * 取舍：统一将 send/voice 按钮映射到中性白底 + 深色图标，保持与暗色主题的一致语义。
   */
  --sb-action-icon: var(--color-text);
  --sb-cta: color-mix(in srgb, var(--neutral-0) 96%, transparent 4%);
  --sb-cta-icon: var(--color-text);
  --sb-voice-color: var(--color-text);
  --sb-border: var(--sb-stroke);
  --sb-border-active: color-mix(
    in srgb,
    var(--sb-stroke) 55%,
    var(--color-text) 45%
  );
  --sb-bg: var(--sidebar-panel, var(--sb-surface));
  --sb-bg-hover: var(
    --sidebar-hover-bg,
    color-mix(in srgb, var(--sidebar-panel, var(--sb-surface)) 90%, white 10%)
  );
  --sb-panel: color-mix(in srgb, var(--color-surface-alt) 96%, white 4%);
  --sb-panel-strong: color-mix(
    in srgb,
    var(--color-surface-alt) 88%,
    var(--color-text) 12%
  );
  --sb-inner-highlight: color-mix(
    in srgb,
    var(--color-text) 8%,
    transparent 92%
  );
  --sb-ring: 0 0 0 var(--sb-ring-width, 2px)
    color-mix(in srgb, var(--border-color) 60%, transparent 40%);
  --ring-focus: 0 0 0 var(--sb-ring-width, 2px)
    color-mix(in srgb, var(--border-color) 60%, transparent 40%);
  --sb-shadow: 0 24px 48px
    color-mix(in srgb, var(--shadow-color) 55%, transparent 45%);
  --sb-shadow-soft: 0 16px 32px
    color-mix(in srgb, var(--shadow-color) 50%, transparent 50%);
  --sb-menu-shadow: 0 28px 60px
    color-mix(in srgb, var(--shadow-color) 60%, transparent 40%);
  --sb-caret: color-mix(in srgb, var(--color-text) 50%, transparent 50%);
  --chip-bg: color-mix(in srgb, var(--color-surface-alt) 86%, white 14%);
  --chip-bg-hover: color-mix(
    in srgb,
    var(--chip-bg) 88%,
    var(--color-text) 12%
  );
  --chip-text: color-mix(in srgb, var(--color-text) 84%, transparent 16%);
  --divider-color: var(--sb-divider);
  --menu-bg: var(
    --sb-bg,
    color-mix(in srgb, var(--color-surface-alt) 96%, white 4%)
  );
  --menu-border: color-mix(in srgb, var(--border-color) 78%, transparent 22%);
  --menu-hover: color-mix(in srgb, var(--menu-bg) 80%, var(--color-text) 20%);
  --menu-code-color: color-mix(in srgb, var(--color-text) 88%, transparent 12%);
  --menu-name-color: color-mix(in srgb, var(--color-text) 70%, transparent 30%);
  --menu-check-color: color-mix(
    in srgb,
    var(--color-text) 65%,
    transparent 35%
  );
  --menu-scroll-track: color-mix(in srgb, var(--menu-bg) 70%, transparent 30%);
  --menu-scroll-thumb: color-mix(
    in srgb,
    var(--border-color) 55%,
    transparent 45%
  );
  --menu-scroll-thumb-hover: color-mix(
    in srgb,
    var(--border-color) 70%,
    transparent 30%
  );
  --direction-icon: color-mix(in srgb, var(--color-text) 55%, transparent 45%);
  --text-primary: var(--sb-text);
  --text-muted: var(--sb-muted);
  --sb-scroll-track: color-mix(in srgb, var(--menu-bg) 60%, transparent 40%);
  --sb-scroll-thumb: color-mix(
    in srgb,
    var(--menu-scroll-thumb) 85%,
    transparent 15%
  );
  --sb-send-bg: color-mix(in srgb, var(--neutral-0) 94%, transparent 6%);
  --sb-send-color: var(--color-text);
  --sb-cta-shadow: 0 18px 40px
    color-mix(in srgb, var(--shadow-color) 55%, transparent 45%);
  --sb-cta-shadow-hover: 0 22px 48px
    color-mix(in srgb, var(--shadow-color) 65%, transparent 35%);
}

:root[data-theme="system"] {
  --sb-surface: color-mix(in srgb, var(--color-surface-alt) 92%, white 8%);
  --sb-inner: color-mix(in srgb, var(--color-surface-alt) 88%, white 12%);
  --sb-seg: color-mix(
    in srgb,
    var(--color-surface-alt) 82%,
    var(--color-text) 18%
  );
  --sb-stroke: color-mix(in srgb, var(--border-color) 85%, transparent 15%);
  --sb-divider: color-mix(in srgb, var(--border-color) 70%, transparent 30%);
  --sb-text: var(--color-text);
  --sb-muted: color-mix(in srgb, var(--color-text) 58%, transparent 42%);
  --sb-icon: var(--color-text);
  /*
   * system 模式在浅色媒体查询下与 light 对齐，CTA 壳体同样采用白色系映射。
   */
  --sb-action-icon: var(--color-text);
  --sb-cta: color-mix(in srgb, var(--neutral-0) 96%, transparent 4%);
  --sb-cta-icon: var(--color-text);
  --sb-voice-color: var(--color-text);
  --sb-border: var(--sb-stroke);
  --sb-border-active: color-mix(
    in srgb,
    var(--sb-stroke) 55%,
    var(--color-text) 45%
  );
  --sb-bg: var(--sidebar-panel, var(--sb-surface));
  --sb-bg-hover: var(
    --sidebar-hover-bg,
    color-mix(in srgb, var(--sidebar-panel, var(--sb-surface)) 90%, white 10%)
  );
  --sb-panel: color-mix(in srgb, var(--color-surface-alt) 96%, white 4%);
  --sb-panel-strong: color-mix(
    in srgb,
    var(--color-surface-alt) 88%,
    var(--color-text) 12%
  );
  --sb-inner-highlight: color-mix(
    in srgb,
    var(--color-text) 8%,
    transparent 92%
  );
  --sb-ring: 0 0 0 var(--sb-ring-width, 2px)
    color-mix(in srgb, var(--border-color) 60%, transparent 40%);
  --ring-focus: 0 0 0 var(--sb-ring-width, 2px)
    color-mix(in srgb, var(--border-color) 60%, transparent 40%);
  --sb-shadow: 0 24px 48px
    color-mix(in srgb, var(--shadow-color) 55%, transparent 45%);
  --sb-shadow-soft: 0 16px 32px
    color-mix(in srgb, var(--shadow-color) 50%, transparent 50%);
  --sb-menu-shadow: 0 28px 60px
    color-mix(in srgb, var(--shadow-color) 60%, transparent 40%);
  --sb-caret: color-mix(in srgb, var(--color-text) 50%, transparent 50%);
  --chip-bg: color-mix(in srgb, var(--color-surface-alt) 86%, white 14%);
  --chip-bg-hover: color-mix(
    in srgb,
    var(--chip-bg) 88%,
    var(--color-text) 12%
  );
  --chip-text: color-mix(in srgb, var(--color-text) 84%, transparent 16%);
  --divider-color: var(--sb-divider);
  --menu-bg: var(
    --sb-bg,
    color-mix(in srgb, var(--color-surface-alt) 96%, white 4%)
  );
  --menu-border: color-mix(in srgb, var(--border-color) 78%, transparent 22%);
  --menu-hover: color-mix(in srgb, var(--menu-bg) 80%, var(--color-text) 20%);
  --menu-code-color: color-mix(in srgb, var(--color-text) 88%, transparent 12%);
  --menu-name-color: color-mix(in srgb, var(--color-text) 70%, transparent 30%);
  --menu-check-color: color-mix(
    in srgb,
    var(--color-text) 65%,
    transparent 35%
  );
  --menu-scroll-track: color-mix(in srgb, var(--menu-bg) 70%, transparent 30%);
  --menu-scroll-thumb: color-mix(
    in srgb,
    var(--border-color) 55%,
    transparent 45%
  );
  --menu-scroll-thumb-hover: color-mix(
    in srgb,
    var(--border-color) 70%,
    transparent 30%
  );
  --direction-icon: color-mix(in srgb, var(--color-text) 55%, transparent 45%);
  --text-primary: var(--sb-text);
  --text-muted: var(--sb-muted);
  --sb-scroll-track: color-mix(in srgb, var(--menu-bg) 60%, transparent 40%);
  --sb-scroll-thumb: color-mix(
    in srgb,
    var(--menu-scroll-thumb) 85%,
    transparent 15%
  );
  --sb-send-bg: color-mix(in srgb, var(--neutral-0) 94%, transparent 6%);
  --sb-send-color: var(--color-text);
  --sb-cta-shadow: 0 18px 40px
    color-mix(in srgb, var(--shadow-color) 55%, transparent 45%);
  --sb-cta-shadow-hover: 0 22px 48px
    color-mix(in srgb, var(--shadow-color) 65%, transparent 35%);
}

:root.dark,
:root[data-theme="dark"] {
  --sb-surface: #0e1116;
  --sb-inner: #11161e;
  --sb-seg: #141b24;
  --sb-stroke: rgb(255 255 255 / 6%);
  --sb-divider: rgb(255 255 255 / 10%);
  --sb-text: #edeff2;
  --sb-muted: #9fa7b3;
  --sb-icon: #edeff2;
  --sb-action-icon: var(--sb-icon);
  --sb-cta: #fff;
  --sb-cta-icon: #0e1116;
  --sb-voice-color: var(--sb-icon);
  --sb-border: var(--sb-stroke);
  --sb-border-active: color-mix(in srgb, var(--sb-stroke) 60%, white 40%);
  --sb-bg: var(--sidebar-panel, var(--sb-surface));
  --sb-bg-hover: var(
    --sidebar-hover-bg,
    color-mix(in srgb, var(--sidebar-panel, var(--sb-surface)) 94%, white 6%)
  );
  --sb-panel: var(--sb-inner);
  --sb-panel-strong: color-mix(in srgb, var(--sb-inner) 88%, black 12%);
  --sb-inner-highlight: rgb(255 255 255 / 12%);
  --sb-ring: 0 0 0 2px rgb(255 255 255 / 8%);
  --ring-focus: 0 0 0 2px rgb(255 255 255 / 8%);
  --sb-shadow: 0 6px 20px rgb(0 0 0 / 25%);
  --sb-shadow-soft: 0 4px 16px rgb(0 0 0 / 22%);
  --sb-menu-shadow: 0 18px 44px rgb(0 0 0 / 45%);
  --sb-caret: #99a6b5;
  --chip-bg: #252b33;
  --chip-bg-hover: #2b323c;
  --chip-text: #d5dbe6;
  --divider-color: var(--sb-divider);
  --menu-bg: var(--sb-bg, var(--sb-inner));
  --menu-border: color-mix(in srgb, var(--sb-stroke) 80%, black 20%);
  --menu-hover: color-mix(in srgb, var(--menu-bg) 88%, white 12%);
  --menu-code-color: #f1f4f8;
  --menu-name-color: #c6ccd7;
  --menu-check-color: #d9dee7;
  --menu-scroll-track: color-mix(in srgb, var(--menu-bg) 70%, transparent);
  --menu-scroll-thumb: color-mix(in srgb, var(--menu-bg) 20%, white 12%);
  --menu-scroll-thumb-hover: color-mix(
    in srgb,
    var(--menu-scroll-thumb) 70%,
    white 30%
  );
  --direction-icon: #b8c2cf;
  --text-primary: var(--sb-text);
  --text-muted: var(--sb-muted);
  --sb-scroll-track: color-mix(in srgb, var(--sb-inner) 35%, transparent);
  --sb-scroll-thumb: color-mix(in srgb, var(--sb-inner) 65%, transparent);
  --sb-send-bg: rgb(255 255 255 / 92%);
  --sb-send-color: #0b0d11;
  --sb-cta-shadow: 0 10px 30px rgb(0 0 0 / 30%);
  --sb-cta-shadow-hover: 0 12px 32px rgb(0 0 0 / 32%);
}
