/*
 * 背景：
 *  - 图标缺失时需回退为首字母方块，旧实现依赖旧版主题变量，无法适配新的 roles token。
 * 目的：
 *  - 使用 roles token 重写回退样式，确保在 light/dark 与反相场景下对比度一致。
 * 关键决策与取舍：
 *  - 通过 color-mix 提供柔和背景，同时允许 data-variant 微调字重与字距；
 *  - 支持 `.dark` class 与 data-theme 并存，兼容旧逻辑。
 * 影响范围：
 *  - 所有依赖 ThemeIcon 回退渲染的组件。
 * 演进与TODO：
 *  - 后续可接入角色色盘控制不同品牌的 fallback 配色策略。
 */
.fallback {
  --icon-fallback-size: 24px;
  --icon-fallback-bg: color-mix(in oklab, var(--role-surface) 92%, transparent);
  --icon-fallback-color: var(--role-on-surface);
  --icon-fallback-ring: color-mix(
    in oklab,
    var(--role-border) 70%,
    transparent
  );

  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: var(--icon-fallback-size);
  height: var(--icon-fallback-size);
  border-radius: var(--radius-xl, 0.875rem);
  background: var(--icon-fallback-bg);
  color: var(--icon-fallback-color);
  font-family: Inter, "SF Pro Display", "Segoe UI", system-ui, sans-serif;
  font-size: calc(var(--icon-fallback-size) * 0.46);
  font-weight: 600;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  box-shadow: inset 0 0 0 1px var(--icon-fallback-ring);
  line-height: 1;
}

.inline {
  /*
   * 背景：
   *  - 图标切换为内联 SVG 后需提供默认尺寸，同时允许调用方通过 CSS
   *    或属性覆盖宽高，避免破坏现有布局。
   * 目的：
   *  - 以 CSS 变量暴露尺寸控制点，默认回退到 1.25em，可被外部样式或
   *    ThemeIcon style 覆盖；保持 currentColor 继承语义。
   */
  display: inline-flex;
  align-items: center;
  justify-content: center;
  line-height: 0;
  flex-shrink: 0;
  color: inherit;

  --icon-inline-size: 1.25em;

  width: var(--icon-inline-width, var(--icon-inline-size));
  height: var(--icon-inline-height, var(--icon-inline-size));
}

.inline > svg {
  width: 100%;
  height: 100%;
  display: block;
  fill: currentcolor;
  stroke: currentcolor;
}

.fallback[data-variant="apple"] {
  letter-spacing: 0.04em;
}

.fallback[data-variant="wechat"] {
  font-size: calc(var(--icon-fallback-size) * 0.42);
}

.fallback[data-variant="google"] {
  font-weight: 700;
}

:global(.dark) .fallback,
:root[data-theme="dark"] .fallback {
  --icon-fallback-bg: color-mix(
    in oklab,
    var(--role-surface-strong) 82%,
    transparent
  );
  --icon-fallback-color: var(--role-on-surface-strong);
  --icon-fallback-ring: color-mix(
    in oklab,
    var(--role-border) 55%,
    transparent
  );
}

:root[data-theme="system"] .fallback {
  --icon-fallback-bg: color-mix(in oklab, var(--role-surface) 92%, transparent);
  --icon-fallback-color: var(--role-on-surface);
  --icon-fallback-ring: color-mix(
    in oklab,
    var(--role-border) 70%,
    transparent
  );
}

@media (prefers-color-scheme: dark) {
  :root[data-theme="system"] .fallback {
    --icon-fallback-bg: color-mix(
      in oklab,
      var(--role-surface-strong) 82%,
      transparent
    );
    --icon-fallback-color: var(--role-on-surface-strong);
    --icon-fallback-ring: color-mix(
      in oklab,
      var(--role-border) 55%,
      transparent
    );
  }
}
