/**
 * 背景：
 *  - 头像裁剪需要在偏好设置与模态中复用一致的奢侈品级极简体验。
 * 目的：
 *  - 构建统一的裁剪布局与控制条，突出方形取景与内切圆提示，确保操作节奏清晰。
 * 关键决策与取舍：
 *  - 使用 CSS 自定义属性对齐 Settings 面板的配色变量；
 *  - 通过伪元素渲染遮罩与内切圆，避免引入额外 DOM；
 *  - 控制按钮采用离散间距与 4 的倍数体系，保持视觉节奏一致。
 * 影响范围：
 *  - AvatarCropperModal 组件。
 * 演进与TODO：
 *  - TODO: 后续可接入主题动画或触控反馈，进一步提升交互细腻度。
 */

.dialog {
  --avatar-cropper-surface: color-mix(
    in srgb,
    var(--preferences-panel-surface, rgb(255 255 255 / 6%)) 92%,
    transparent
  );
  --avatar-cropper-border: color-mix(
    in srgb,
    var(--preferences-panel-ring, rgb(255 255 255 / 18%)) 72%,
    transparent
  );
  --avatar-cropper-muted: color-mix(
    in srgb,
    var(--preferences-panel-muted, #8f96a8) 94%,
    transparent
  );
  --avatar-cropper-overlay: rgb(10 12 16 / 68%);
  --avatar-cropper-circle: rgb(255 255 255 / 82%);
  --avatar-cropper-viewport: 320px;

  inline-size: min(520px, 92vw);
  display: flex;
  flex-direction: column;
  gap: 24px;
  color: var(--preferences-panel-text, var(--app-color));
}

.header {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.title {
  margin: 0;
  font-size: 20px;
  font-weight: 600;
  letter-spacing: 0.02em;
}

.subtitle,
.orientation {
  margin: 0;
  color: var(--avatar-cropper-muted);
  font-size: 14px;
  line-height: 1.6;
}

.viewport {
  position: relative;
  inline-size: min(var(--avatar-cropper-viewport), 72vw);
  block-size: min(var(--avatar-cropper-viewport), 72vw);
  margin-inline: auto;
  border-radius: 24px;
  background: var(--avatar-cropper-surface);
  box-shadow: inset 0 0 0 1px var(--avatar-cropper-border);
  overflow: hidden;
}

.preview-layer {
  position: relative;
  inline-size: 100%;
  block-size: 100%;
  cursor: grab;
}

.preview-layer[data-disabled="true"] {
  cursor: default;
}

.preview-layer[data-dragging="true"] {
  cursor: grabbing;
}

.center {
  position: absolute;
  inset-block-start: 50%;
  inset-inline-start: 50%;
  transform: translate(-50%, -50%);
  inline-size: 0;
  block-size: 0;
}

.translate {
  position: relative;
  transform: translate3d(var(--translate-x, 0), var(--translate-y, 0), 0);
}

.rotate {
  position: relative;
  transform-origin: center;
}

.scale {
  position: relative;
  transform-origin: center;
}

.image {
  display: block;
  max-inline-size: none;
  max-block-size: none;
  user-select: none;
  pointer-events: none;
  -webkit-user-drag: none;
}

.overlay {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

.overlay::before {
  content: "";
  position: absolute;
  inset: 0;
  background: radial-gradient(
    circle at center,
    transparent 49%,
    var(--avatar-cropper-overlay) 51%
  );
}

.overlay::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 50%;
  border: 2px solid var(--avatar-cropper-circle);
  box-shadow: 0 0 0 1px rgb(8 9 13 / 45%);
}

.controls {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.zoom-controls,
.rotate-controls {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
}

.zoom-slider {
  inline-size: min(220px, 60vw);
}

.control-button {
  inline-size: 44px;
  block-size: 44px;
  border-radius: 14px;
  border: 1px solid var(--avatar-cropper-border);
  background: color-mix(
    in srgb,
    var(--avatar-cropper-surface) 88%,
    transparent
  );
  color: inherit;
  font-size: 18px;
  line-height: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition:
    background 160ms cubic-bezier(0.2, 0.8, 0.2, 1),
    transform 160ms cubic-bezier(0.2, 0.8, 0.2, 1),
    border-color 160ms cubic-bezier(0.2, 0.8, 0.2, 1);
}

.control-button:focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px
    color-mix(in srgb, var(--avatar-cropper-border) 65%, transparent);
}

.control-button:hover:not([disabled]) {
  transform: translateY(-1px);
  background: color-mix(
    in srgb,
    var(--avatar-cropper-surface) 96%,
    transparent
  );
}

.control-button:active:not([disabled]) {
  transform: translateY(0);
}

.control-button[disabled] {
  opacity: 0.5;
  cursor: not-allowed;
}

.actions {
  display: flex;
  justify-content: flex-end;
  gap: 16px;
}

.helper {
  font-size: 13px;
  color: var(--avatar-cropper-muted);
  text-align: center;
}

:global(:root[data-theme="light"]) .dialog {
  --avatar-cropper-surface: color-mix(
    in srgb,
    var(--preferences-panel-surface, rgb(15 17 21 / 6%)) 94%,
    transparent
  );
  --avatar-cropper-border: color-mix(
    in srgb,
    var(--preferences-panel-border, #d9dde7) 84%,
    transparent
  );
  --avatar-cropper-muted: color-mix(
    in srgb,
    var(--preferences-panel-muted, #6f7585) 100%,
    transparent
  );
  --avatar-cropper-overlay: rgb(15 17 21 / 60%);
  --avatar-cropper-circle: rgb(18 20 24 / 78%);
}
