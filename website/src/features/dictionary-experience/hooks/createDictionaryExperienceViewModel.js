import { buildDictionaryActionBarModel } from "./buildDictionaryActionBarModel.js";

export function createDictionaryExperienceViewModel({
  inputRef,
  t,
  text,
  setText,
  dictionarySourceLanguage,
  setDictionarySourceLanguage,
  dictionaryTargetLanguage,
  setDictionaryTargetLanguage,
  sourceLanguageOptions,
  targetLanguageOptions,
  handleSwapLanguages,
  handleSend,
  handleShowDictionary,
  handleShowLibrary,
  handleSelectHistory,
  activeView,
  isDictionaryViewActive,
  isHistoryViewActive,
  isLibraryViewActive,
  focusInput,
  entry,
  finalText,
  loading,
  activeTerm,
  lang,
  handleReoutput,
  isTermActionable,
  handleCopy,
  canCopyDefinition,
  copyFeedbackState,
  isCopySuccessActive,
  handleDeleteHistory,
  handleReport,
  popupOpen,
  popupMsg,
  closePopup,
  popupConfig,
  toastState,
  closeToast,
  reportDialog,
  reportDialogHandlers,
  dictionaryFlavor,
  libraryLandingLabel,
}) {
  const isEmptyStateActive =
    isDictionaryViewActive && !entry && !finalText && !loading;
  const displayClassName = [
    "display",
    isEmptyStateActive ? "display-empty" : "",
  ]
    .filter(Boolean)
    .join(" ");

  const dictionaryActionBarProps = buildDictionaryActionBarModel({
    resolvedTerm: activeTerm,
    lang,
    handleReoutput,
    isTermActionable,
    loading,
    handleCopy,
    canCopyDefinition,
    copyFeedbackState,
    isCopySuccessActive,
    handleDeleteHistory,
    entry,
    finalText,
    handleReport,
  });

  return {
    inputRef,
    t,
    text,
    setText,
    dictionarySourceLanguage,
    setDictionarySourceLanguage,
    dictionaryTargetLanguage,
    setDictionaryTargetLanguage,
    sourceLanguageOptions,
    targetLanguageOptions,
    handleSwapLanguages,
    handleSend,
    handleShowDictionary,
    handleShowLibrary,
    handleSelectHistory,
    activeView,
    viewState: {
      active: activeView,
      isDictionary: isDictionaryViewActive,
      isHistory: isHistoryViewActive,
      isLibrary: isLibraryViewActive,
    },
    focusInput,
    entry,
    finalText,
    loading,
    dictionaryActionBarProps,
    displayClassName,
    isEmptyStateActive,
    popupOpen,
    popupMsg,
    popupConfig,
    closePopup,
    toast: toastState,
    closeToast,
    handleCopy,
    reportDialog,
    reportDialogHandlers,
    canCopyDefinition,
    lang,
    dictionaryFlavor,
    libraryLandingLabel,
    dictionaryTargetLanguageLabel: t.dictionaryTargetLanguageLabel,
    dictionarySourceLanguageLabel: t.dictionarySourceLanguageLabel,
    dictionarySwapLanguagesLabel: t.dictionarySwapLanguages,
    searchEmptyState: {
      title: t.searchEmptyTitle,
      description: t.searchEmptyDescription,
    },
    chatInputPlaceholder: t.inputPlaceholder,
  };
}
