# 背景：
#  - 需要在 CI/CD 阶段阻断前后端新增的超长业务文件，避免评审疏漏。
# 目的：
#  - 在 Pull Request 流水线中执行统一的业务文件行数检查脚本。
# 关键决策与取舍：
#  - 通过 Node 脚本复用策略模式配置，支持前后端两类目录；
#  - 仅在 PR 中检查改动文件，避免对存量超长文件造成一次性阻断；
#  - 使用 checkout@v4 + 全量 fetch，保证能够与目标基线比对。
# 影响范围：
#  - 所有指向 main/trunk 的 PR 只要涉及 website 或 backend 目录都会触发本流程。
# 演进与TODO：
#  - 后续可与 lint 流程合并或扩展到更多目录（如运维脚本）。
name: business-line-guard

on:
  pull_request:
    branches: ["trunk", "main"]
    paths:
      - "backend/**"
      - "website/**"
      - "scripts/enforce-business-line-limits.mjs"
      - ".github/workflows/line-guard.yml"

jobs:
  enforce-file-lines:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Enforce business file line limits
        run: node scripts/enforce-business-line-limits.mjs --base-ref ${{ github.event.pull_request.base.sha }}
