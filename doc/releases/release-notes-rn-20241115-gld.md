# Release Notes · RN-20241115-GLD

| 字段 | 内容 |
| --- | --- |
| Release ID | RN-20241115-GLD |
| Version Tag | `glancy.dict.v1`（Additive Patch） |
| Window | 2024-11-15 02:00–06:00 UTC · REL-B0→REL-B3（参照[21.4 灰度分层](<../需求说明文档/第 21 章 发布计划与灰度策略.md#214-放量策略（灰度分层）>)) |
| Scope & Modules | `/api/v1/lookup`、历史/导出视图、Web/H5 释义组件 |
| Change Type | CT-01（向后兼容字段新增）；Deprecation 日历：DEP-2024Q4-001 |
| User Impact | 每条释义均展示出处标签，帮助学习者识别自研/授权词典内容，并支撑教师溯源场景 |
| Guardrails | `/lookup` 首屏 P95 ≤2.5 s、均值 ≤1.2 s；429 ≤3%；契约回放≥500（见[21.3 发布门禁](<../需求说明文档/第 21 章 发布计划与灰度策略.md#213-发布门禁（pre-flight-gate）>)) |
| Deployment Plan | 蓝绿→REL-B0 健康检查→REL-B1 1%→REL-B2 5%→REL-B3 15%→REL-B5 全量；任何红灯按 21.5 回滚 |
| Documentation & SDK | `doc/需求说明文档/第 8 章` Schema 样例已补充 `source`；前端组件指南与 SDK JS v0.11 同步示例 |
| Next Steps | 观测 HK-02/HK-03 钩子并把指标回填至 DEP-2024Q4-001，收集课堂场景反馈 |
| Approvals | 产品 ✅ · 架构 ✅ · SRE ✅ · 合规 ✅ |

## 新功能

### 释义来源标注
- `modules.definitions[*].source` 提供释义出处（如 `longman`、`glancy-curated`），贯穿 `/api/v1/lookup`、历史详情与导出结果，便于对外引用时标明来源。
- UI 在释义卡片与 Hover 提示内展示来源；导出 CSV/JSON 增加 `source` 列以满足教学留痕。
- **关联用例**： [UC-01 查询词条](<../需求说明文档/第 4 章 业务流程与用例.md#uc-01-查询词条>)
- **关联验收**： [AC-UC-01](<../需求说明文档/第 20 章 验收标准与测试方案（UC 对齐）.md#ac-uc-01>)

## 修复

- 无新的用户可见缺陷修复；本次列车仅交付释义来源标注能力。

## 兼容性变更

- `glancy.dict.v1` 契约保持不变；`definitions[*].source` 为可选字段，未更新客户端可安全忽略（参见[22.4.2 兼容性分级](<../需求说明文档/第 22 章 变更管理与版本策略（契约弃用期）.md#2242-兼容性分级>))。
- JSON Schema 与契约样本已更新，CI 需确保 ≥500 条样本全部通过；日志新增字段监控以捕获解析异常。

## 升级影响

- API 调用方若采集释义字段做 BI，需要在白名单中加入 `source` 以避免落库失败；同时更新审计日志模板以记录该字段。
- Web/H5 客户端可直接读取新字段并按 i18n 资源 `dict.definition.source.*` 展示；未升级的客户端仍会回退到无来源状态。
- 导出脚本与批量处理需同步 Schema，以确保 `UC-01/AC-UC-01` 的溯源要求与《用例说明书》保持一致。

## 回滚步骤

1. 触发 `release_batches` 工单的 “Rollback Draft”，按[21.12 上线步骤](<../需求说明文档/第 21 章 发布计划与灰度策略.md#2112-上线步骤清单（运行级）>)冻结放量并退回 REL-B2。
2. 通过配置中心将“释义来源标注”特性开关关闭（参见[21.7 特性开关](<../需求说明文档/第 21 章 发布计划与灰度策略.md#217-特性开关与配置管理>))，并回滚 Website/BFF 到上一版本镜像。
3. 清空 L1/L2 缓存并回放 50 条契约样本，确认旧版响应不再携带 `source` 字段后再恢复放量。

## 已知问题

- **ISSUE#T03-API-01**：`/api/v1` 前缀与统一 `schemaVersion/quota` 头尚未在当前后端实现，释义来源仍依赖 legacy `GET /api/words` 路径（见[第 8 章 接口契约](<../需求说明文档/第 8 章 接口与数据契约（APISchema）.md>)）。该缺陷将在后续 `/api/v1` 重构中一并解决。
- **ISSUE#T03-QUOTA-02**：查词/再生成配额头仍缺失（参见[第 10 章 配额、限流与成本控制](<../需求说明文档/第 10 章 配额、限流与成本控制.md>))，因此本版本 UI 仍需依赖备用配额提示，预计在 Billing 改造完成后关闭。
