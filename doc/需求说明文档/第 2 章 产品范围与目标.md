# 第 2 章 产品范围与目标

> 本章在[第 1 章 引言](<./第 1 章 引言.md>)既有约束与成功标准的基础上，统一定义 MVP 阶段的产品范围、目标与不做清单，作为后续用例、功能需求与验收的边界依据。

## 2.0 章节六段式概览

| 段落     | 摘要                                                                 | 关联章节 |
| -------- | -------------------------------------------------------------------- | -------- |
| 问题背景 | 个性化词典需在有限周期内交付“查询即理解”闭环，确保白名单语言对与订阅档位有清晰边界。 | 2.1      |
| 目标     | 体验/理解/可靠三类 Outcome（首屏 P95 ≤ 2.5 s、结构化正确率 ≥ 99%、订阅/导出稳定）构成 MVP 的成功门槛。 | 2.2、1.6 |
| 范围     | In Scope 包含查词/输出模块、输入规则、画像、账户/订阅、历史/导出与技术最小集六大块。 | 2.3      |
| 约束     | 明确不做清单（离线、整句、扩展语种、收藏、内购等）与变更控制路径，防止范围漂移。 | 2.4、2.8 |
| 依赖     | Doubao、登录/支付、缓存/降级、订阅矩阵、合规条款等外部依赖需具备冗余与熔断策略。 | 2.7      |
| 验收引用 | 本章目标映射到[第 20 章 20.3/20.6/20.15](<./第 20 章 验收标准与测试方案（UC 对齐）.md#203-验收门槛摘要（发布必过）>) 的“发布必过指标”和“发布前检查清单”。 | 20.3、20.15 |

## 2.1 产品定位与范围边界

### 2.1.1 定位

- **产品形态**：个性化电子词典，围绕“查询即理解”的最小闭环，提供与用户画像和查词历史相关的释义与例句。
- **平台形态**：MVP 仅交付 Web 与 H5，原生客户端与应用商店内购不在本期范围。

### 2.1.2 使用人群与场景

- **目标用户**：需要英中双语或同语解释的学习者与职场用户，覆盖从 CEFR A1 至 C2 的不同水平。
- **核心场景**：输入单词或词组后，获得结构化释义、个性化例句、常见/固定搭配、同反义词与词族，支持难度与风格调节以及再生成。

### 2.1.3 范围边界（MVP）

- **语言对白名单**：L1 zh→en、L2 en→zh、L3 en→en、L4 zh→zh；同语模式不显示译文。非白名单拒绝。
- **输入限制**：只接受“单词/词组”；输入整句时前端与后端均提示并拒绝。
- **客户端能力**：不要求离线；不提供收藏；数据留存与清理按档位与设置执行。
- **外部依赖**：仅对接 Doubao API（生成与理解），以及微信/Apple/Google 登录；MVP 的 Web/H5 支付仅接入微信支付与支付宝。

## 2.2 产品目标（Outcome）

| 目标类别                                         | 目标描述             | 量化口径/阈值                                            | 备注                       |
| ------------------------------------------------ | -------------------- | -------------------------------------------------------- | -------------------------- |
| 体验目标                                         | 首屏查词快速可达     | 端到端 P95 ≤ 2.5 s，平均 ≤ 1.2 s                         | 以端到端口径统计与验收为准 |
| 理解目标                                         | 结构化与可理解输出   | 结构化输出正确率 ≥ 99%；例句理解正反馈 ≥ 80%             | 采样与回执口径见测试方案   |
| 可靠目标                                         | 登录、订阅、导出稳定 | 登录成功率 ≥ 99%；订阅开通与续费成功率 ≥ 98%；导出 ≤ 5 s | 失败均需可重试与回执       |
| 上述阈值继承第 1 章成功标准，作为 MVP 发布门槛。 |                      |                                                          |                            |

## 2.3 MVP 范围清单（In Scope）

> 本小节为“必须交付”的最小能力集合，作为用例与 FR 的需求来源。

### 2.3.1 查词与输出模块

- **模块集合**：释义与义项、个性化例句、常见搭配、固定搭配、同义词与反义词、派生与词族。默认全部开启，按模块优先级渲染；详略级别与条数随订阅档位而异。
- **个性化例句**：支持难度与风格切换；同语模式不显示译文；按档位提供 1/3/5 条与再生成次数。
- **频率与考试标签**：界面占位为徽标，不在 MVP 实现，仅保留“暂不实现”标识。

### 2.3.2 输入与规则

- **输入类型**：单词/词组；支持简短上下文词组以提升相关性。句子输入拒绝并提示改为词或词组。
- **释义呈现**：按相关性排序的多义项，不展示排序原因。

### 2.3.3 个性化画像与偏好

- **画像字段**：学习目标、专业背景、年龄层次、当前水平（CEFR/IELTS/TOEFL/CET/自评）、语言对、风格标签（数量上限依档位）。用于生成控制与排序，不对外泄露。

### 2.3.4 账户、订阅与配额

- **登录**：邮箱与第三方登录（微信/Apple/Google）。
- **订阅档位**：`FREE_USER` / `PLUS_USER` / `PRO_USER` 三档，权益矩阵以[第 11 章 订阅、计费与账单](<./第 11 章 订阅、计费与账单.md>)为唯一权威（SSoT），本章仅保留档位命名与职责描述；到期自动降级并同步边界。
- **日配额**：查词次数与再生成次数按“自然日”重置，跨端共享；超限返回 429（错误码 RATE_LIMITED，详见[第 8 章「典型错误码」](<./第 8 章 接口与数据契约（APISchema）.md#8102-典型错误码>)).

### 2.3.5 历史与数据控制

- **留存与清理**：`FREE_USER` 10 天/100 条；`PLUS_USER` 90 天/1000 条；`PRO_USER` 永久。支持无痕查询、按语言清理、导出 CSV/JSON；删除为“即时逻辑删除+7 天延迟物理清理”。

### 2.3.6 技术实现最小集

- **模型接入**：Doubao API 的稳定封装、重试、超时、错误语义化、结构化契约解析与容错。
- **缓存与降级**：同用户/词条/配置短时缓存；依赖异常时退化到基础释义与模板例句并提示。
- **设置**：主题、快捷键、界面语言。

## 2.4 非目标与不做清单（Out of Scope，MVP）

| 类别     | 不在本期范围                 | 依据                            |
| -------- | ---------------------------- | ------------------------------- |
| 输入形态 | 整句翻译、段落改写、语法批改 | MVP 仅支持单词/词组输入与处理。 |
| 语种     | 白名单以外的语言对           | 仅 L1–L4。                      |
| 模块     | 频率与考试标签的实际能力     | 明确“暂不实现”。                |
| 客户端   | 离线使用、桌面原生客户端     | 首期仅 Web/H5。                 |
| 支付     | 应用商店内购                 | [第 11 章 订阅、计费与账单](<./第 11 章 订阅、计费与账单.md>)限定 MVP 支付仅 Web/H5 微信/支付宝。 |
| 数据     | 收藏/标注功能                | 文档明确“系统不提供收藏功能”。  |
| 模型     | 训练/微调                    | 不进行基础模型训练或微调。      |

## 2.5 里程碑与交付物（MVP）

| 里程碑         | 交付物                                                       | 进入条件                              | 退出标准                                   |
| -------------- | ------------------------------------------------------------ | ------------------------------------- | ------------------------------------------ |
| M0 方案冻结    | 结构化契约 `glancy.dict.v1`、用例 UC 草案、契约回放样本≥500 条 | 模块与白名单、配额与订阅矩阵确定      | 契约通过 CI 校验并完成前后端对齐。         |
| M1 内测        | 核心链路可用：查词→渲染→再生成→历史/导出；降级链路           | SLI/SLO 仪表初步接入、RBAC 与审计就绪 | 端到端平均≤1.2 s，错误率可控并有告警抑制。 |
| M2 发布（MVP） | Web/H5 发布包、使用条款与隐私政策、合规清单                  | 支付对账闭环、导出回执、日志与告警    | 达到第 2.2 表中门槛；合规项齐备。          |

## 2.6 验收门槛与度量归口

- **体验类**：端到端 P95、均值、缓存命中率分段呈现（前端/后端/第三方）。
- **质量类**：结构化输出正确率、例句理解正反馈比、解析容错成功率。
- **运营类**：登录成功率、订阅开通与续费成功率、导出完成时延与回执有效率。
- **合规类**：数据主体权利可用性（导出/删除）、最小采集、脱敏与加密、审计日志完整性。

## 2.7 依赖与约束

- **外部依赖**：Doubao API、第三方登录（微信/Apple/Google）与 Web/H5 支付（微信支付/支付宝）；需具备重试、超时、熔断、半开恢复与降级策略。
- **数据与安全**：最小权限 RBAC、传输与存储加密、敏感字段脱敏、审计日志不可篡改与归档。
- **合规**：使用条款与隐私政策内置，提供撤回同意与数据清理入口；跨境与子处理者清单在合规模板维护。

## 2.8 变更控制

- **范围变更**：新增语言对、输入形态或模块能力变更，均视为**范围扩大**，需进入[第 22 章 变更管理与版本策略（契约弃用期）](<./第 22 章 变更管理与版本策略（契约弃用期）.md>)的正式流程并给出弃用期/迁移策略。
- **契约变更**：`glancy.dict.v*` 的不兼容升级必须提供弃用期，契约回放样本≥500 条并通过 CI。

## 2.9 用户身份与模式定义

> 本节作为“用户身份”与“游客模式”唯一事实源（SSoT），要求后续章节以及 SDD/API/DB/测试/用例等文档在涉及身份或游客能力时仅引用本节内容，不得额外发明规则。四个身份枚举统一为：`GUEST` / `FREE_USER` / `PLUS_USER` / `PRO_USER`。

### 2.9.1 身份枚举与场景映射

| 枚举常量    | 中文描述     | 典型场景                                                         | 核心能力概述                                               |
| ----------- | ------------ | ---------------------------------------------------------------- | ---------------------------------------------------------- |
| `GUEST`     | 未登录游客   | 首次访问或不愿登录，仅需即时查词                               | 仅可查词/释义/例句；无留存、无跨端同步；无偏好持久化     |
| `FREE_USER` | 注册免费用户 | 已创建账户但未订阅，或订阅到期后的默认档位                     | 登录态查词、基础历史与导出、有限再生成                    |
| `PLUS_USER` | PLUS 订阅    | 购买 `PLUS_USER` 档位的登录用户                                   | 较大配额、更多例句条数、自定义模块、跨端同步              |
| `PRO_USER`  | PRO 订阅     | 购买 `PRO_USER` 档位的登录用户                                   | 最高配额、完整导出/自定义能力、专家级设置                 |

### 2.9.2 `GUEST` 身份的技术与产品边界

#### 身份与会话（技术路线）

- 采用服务端生成的 `guest_user_id` / `subjectId = s_<sessionId>` 识别 `GUEST` 身份。
- 会话通过 HttpOnly Cookie（`glancy_guest_session`）维护，TTL 固定为 72 小时，到期需重新获取；前端 JavaScript 不可读取该 Cookie。
- 前端在 `GUEST` 模式下禁止向 LocalStorage / IndexedDB 落任何业务数据（仅可使用内存态渲染数据），配额计数完全由服务端维护的短期配额桶完成（`GUEST` 会话 + 服务端短期配额计数 + 无 LocalStorage）。

#### 功能边界（产品约束）

- **允许**：
  - 单词/词组查词；
  - 释义展示；
  - 例句展示（条数可配置，默认 ≤ `FREE_USER` 档基线）。
- **禁止**：
  - 收藏、生词本、标签体系；
  - 跨设备同步、词表/学习进度持久化；
  - 长文本翻译、高成本 LLM 功能；
  - 偏好设置持久化（主题、模块顺序等仅在当前会话内生效）。
- **界面限制**：`GUEST` 界面不提供“最近查过的单词”或“查词历史列表”模块，仅展示当前词条。

#### 多维配额与次数护栏（写死数值）

| 维度                     | 查词 `LOOKUP`（次/日） | LLM/再生成（次/日） | 备注 |
| ------------------------ | ---------------------- | ------------------- | ---- |
| 会话（`guest_user_id`）  | 20                     | 5                   | 由 HttpOnly Cookie 绑定；清除 Cookie 仅重置该维度。 |
| IP (`client_ip`)         | 60                     | 15                  | 同一 IP 下多个浏览器/会话共享，超限立即封顶。 |
| 设备指纹 (`device_fingerprint`) | 60              | 15                  | 生成规则见 12.4.2；与 IP 联动识别频繁换 Cookie 行为。 |
| 新建游客会话（IP）       | 5 次/日                | —                   | 针对 `POST /api/v1/sessions/guest`，超限返回 `GUEST_CREATION_LIMIT_EXCEEDED`。 |

上述阈值为全项目统一配置。任何调整必须同步 12.4.1、10 章配额，以及 API/测试章节，且默认继承本节定义。

### 2.9.3 登录身份约束

- `FREE_USER` / `PLUS_USER` / `PRO_USER` 均以登录用户 ID 为主体，配额、历史留存、导出能力与订阅权益矩阵一致，能力差异详见[第 11 章 订阅、计费与账单](<./第 11 章 订阅、计费与账单.md>)。
- 档位切换（升级、降级、到期回退）须在 5 s 内完成，能力边界与本章身份定义保持一致。
- 后续章节引用身份类型时禁止使用“免费用户/付费用户/游客”等模糊别称，必须写明 `GUEST` / `FREE_USER` / `PLUS_USER` / `PRO_USER`。
