# FR-080 逻辑删除与物理清理（Must）

- **前置**
  - 用户历史存在 5 条记录；具备后台合规删除接口 `POST /api/v1/compliance/delete`。
  - 作业调度（cron）可被触发以模拟 T+7 物理清理。
  - 回执号将写入 `history.cleanup` 事件。
- **步骤**
  1. 在 UC-05 选择 2 条记录进行删除，获取回执号 `receiptId`，刷新历史确认条目立即不可见。
  2. 通过后台接口对指定用户执行“删除全部历史”，验证所有记录逻辑删除并记录回执。
  3. 在 T+3 天内执行 `POST /api/v1/history/{receiptId}/restore`，确认记录被找回。
  4. 手动触发物理清理作业（模拟 T+7），再尝试恢复已超期的回执，确认返回不可恢复提示。
- **期望**
  - 逻辑删除后历史列表立刻隐藏，被删记录不再通过 API 返回。
  - 所有删除/恢复操作都生成回执与 `history.cleanup` 事件，含操作人与范围。
  - 物理清理按 T+7 执行，超期回执不可恢复并返回 410。
- **数据**
  - API：`DELETE /api/v1/history/{id}`、`POST /api/v1/history/{receiptId}/restore`、`POST /api/v1/compliance/delete`。
  - 事件：`history.cleanup`、`history.restore`，字段 `type=user|compliance`。
  - 时间控制：可使用测试时钟模拟 +7 天。
- **优先级**：P0（Must）
- **关联 UC**：UC-05，UC-16
- **关联 AC**：AC-FR-080，AC-UC-05，AC-UC-16
