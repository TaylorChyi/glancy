# FR-100 首屏渐进渲染（Should）

- **前置**
  - 浏览器或 curl 支持 SSE/WebSocket 录制，能够捕获 `first_chunk_latency`、`moduleId` 顺序。
  - 网络分析工具（如 Chrome Performance）可测首个内容模块渲染时间。
  - 具备模拟模块失败的开关（如 `X-Debug-Fail-Module=examples`）。
- **步骤**
  1. 对典型词条 `perspective` 发起查词，记录从点击到收到第一条流式数据/首个模块渲染的时间。
  2. 监听 SSE 流，验证 `definitions` 模块先到达，其次是 `examples`、`collocations` 等；记录 chunk 顺序与间隔。
  3. 注入 `X-Debug-Fail-Module=examples`，再次请求，观察例句模块失败提示是否局部呈现且不阻塞其它模块。
  4. 刷新页面，确认每个模块都有独立的错误提示与重试入口。
- **期望**
  - 首个内容块在 P95 ≤ 2.5 s、平均 ≤ 1.2 s 内渲染；监控中 `first_chunk_latency` 满足阈值。
  - 流式 chunk 顺序固定（释义优先），每个 chunk 含 `moduleId`，确保可追踪；分片间隔 ≤400 ms（参考性能章节）。
  - 指定模块失败时，其他模块照常渲染，失败模块显示“稍后重试”并提供重试按钮，错误不冒泡到全局。
- **数据**
  - SSE 端点：`GET /api/v1/lookup/stream?entry=perspective`（或 WebSocket 等价接口）。
  - 指标：`first_chunk_latency`, `module_render_duration`, `stream_chunks_dropped`。
  - Debug Header：`X-Debug-Fail-Module` 用于注入局部失败。
- **优先级**：P1（Should）
- **关联 UC**：UC-01，UC-14
- **关联 AC**：AC-FR-100，AC-UC-01，AC-UC-14
