# FR-092 退款与异常对账（Should）

- **前置**
  - 订阅订单处于 Plus 档，支付平台支持退款/拒付模拟。
  - 对账系统提供 `POST /api/v1/reconcile` 接口。
  - 审计表需要记录 `refundId`、`status`、`tierBefore`、`tierAfter`。
- **步骤**
  1. 触发 `REFUND_COMPLETED` 回调，检查订阅状态是否回退至到期前档位或 Free，订单保留退款痕迹。
  2. 重放相同退款回调验证幂等处理。
  3. 注入“金额不一致”异常，运行对账任务 `POST /api/v1/reconcile`，观察系统是否补偿更新并生成对账报告。
- **期望**
  - 退款完成后权限同步为 Free（或到期前档位），账单记录保留退款标记，配额/历史等能力立即对齐。
  - 幂等回调不会重复扣减或产生异常状态。
  - 对账异常可自动修正并输出可追溯报告。
- **数据**
  - API：`POST /api/v1/payments/webhook`（事件 `REFUND_COMPLETED`）、`POST /api/v1/reconcile`。
  - 事件：`billing.refund`、`billing.reconcile`。
  - 报表字段：`orderId`, `amount`, `delta`, `resolution`。
- **优先级**：P1（Should）
- **关联 UC**：UC-09，UC-15
- **关联 AC**：AC-FR-092，AC-UC-09，AC-UC-15
