# FR-040 账户注册与登录（Must）

- **前置**
  - 新建邮箱账号与微信/Apple/Google 三方测试账号；SSO 回调指向 Staging。
  - 审计系统可查询 `consent.accepted`、`login.success` 事件。
  - 登录页面具备条款/隐私勾选控件。
- **步骤**
  1. 使用邮箱注册并登录，记录登录完成耗时与成功提示；首次进入需勾选条款/隐私才可继续。
  2. 退出后改用微信登录，观察是否复用同一账号并同步画像初值。
  3. 在设置页撤回条款/隐私同意，确认历史留存入口立即关闭并提示能力变化。
  4. 重新登录，验证撤回状态被保留，并查看审计记录。
- **期望**
  - 首次登录必须勾选条款/隐私，否则“继续”按钮禁用；同意后审计日志记录 `consent.accepted`。
  - OAuth 登录成功率≥99%，并与邮箱账号合并（同一 `subjectId`）。
  - 撤回同意后立即关闭历史与画像相关功能，页面提示“已切换至无痕模式”；再登录时状态保持。
- **数据**
  - API：`POST /api/v1/auth/login`、`POST /api/v1/auth/oauth/callback`、`DELETE /api/v1/profile/consent`。
  - 事件：`login.success`, `consent.revoked`, `history.disabled`。
  - 观测字段：`sessionId`, `subjectId`, `consentStatus`。
- **优先级**：P0（Must）
- **关联 UC**：UC-10，UC-16
- **关联 AC**：AC-FR-040，AC-UC-10，AC-UC-16
