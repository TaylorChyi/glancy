# FR-020 历史留存与上限（Must）

- **前置**
  - Free、Plus、Pro 三档账号的历史留存上限（天数与条数）已知：Free=7 天/100 条、Plus=30 天/500 条、Pro=90 天/2000 条（示例，按第 11 章矩阵填写）。
  - 准备脚本批量调用 `POST /api/v1/lookup` 以便迅速填满历史。
  - API 具备 `X-Client-Mode=incognito` 以模拟无痕模式。
- **步骤**
  1. 对 Free 账号连续触发 110 次查询，随后调用 `GET /api/v1/history?limit=120`，记录返回条数与 `quota.remainingRecords`。
  2. 将 Free 账号切换为“无痕模式”，再次查询，刷新历史列表，确认新记录未写入。
  3. 在 Pro 账号上插入超过 2000 条历史（可导入数据），观察滚动清理是否触发 `history.eviction` 事件并返回剩余额度。
- **期望**
  - 超出上限后最旧记录被滚动删除，最新列表条数≤档位限制，响应体包含 `quota.remainingRecords`。
  - 无痕模式下 `GET /history` 无新增记录，查词响应带 `incognito=true` 标记。
  - `history.eviction` 事件记录被删条数、操作者、时间戳，可供审计。
- **数据**
  - API：`POST /api/v1/lookup`、`GET /api/v1/history`。
  - 事件：`history.eviction`（含 `tier`、`evictedCount`）。
  - 词条集合可循环 `word_{1..N}` 以快速占满额度。
- **优先级**：P0（Must）
- **关联 UC**：UC-04，UC-05，UC-06，UC-11
- **关联 AC**：AC-FR-020，AC-UC-04，AC-UC-05，AC-UC-06，AC-UC-11
