# FR-071 L1/L2 缓存（Should）

- **前置**
  - 两个同租户账号（User A/B），共享语言对与画像。
  - 能查看响应 Header `X-Cache` 值：`MISS`、`HIT_L1`、`HIT_L2`。
  - 可修改画像触发 `profile_etag` 变更。
- **步骤**
  1. User A 查询 `clarify`，记录初始响应 `X-Cache=MISS`，10 秒内重复查询，预期命中 L1（10 分钟 TTL）。
  2. 过 12 分钟后再次查询，确认 L1 失效并重新写入。
  3. User B 在 L1 失效前发起同样查询，若 L2 未过期则返回 `HIT_L2`；记录 TTL（30 分钟）。
  4. User A 更新画像（level 变化），立即查询同词条，验证缓存键变化导致 MISS。
- **期望**
  - 同用户短时间重复请求命中 L1 并返回 `X-Cache=HIT_L1`；超过 10 分钟后失效。
  - 不同用户共享 L2 缓存，命中时 `X-Cache=HIT_L2`；30 分钟后自动过期。
  - 画像或档位变更会触发缓存失效，`profile_etag` 变动带来 MISS。
- **数据**
  - API：`POST /api/v1/lookup`，缓存键组成：`subjectId+lang_pair+entry_norm+config_hash+profile_etag`。
  - Header：`X-Cache`、`X-Cache-TTL`。
  - 词条：`clarify`。
- **优先级**：P1（Should）
- **关联 UC**：UC-01，UC-02，UC-03
- **关联 AC**：AC-FR-071，AC-UC-01
