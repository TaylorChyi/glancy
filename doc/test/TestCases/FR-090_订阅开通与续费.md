# FR-090 订阅开通与续费（Must）

- **前置**
  - Free 账号绑定支付方式；支付沙箱可返回成功、失败、超时事件。
  - 监控订单服务中的 `order.status`、`subscription.tier` 字段。
  - Webhook 身份校验已配置。
- **步骤**
  1. 在 UC-08 选择 Plus 档并完成支付，测量从支付完成到权益生效（`subscription.tier=Plus`）的耗时。
  2. 查看 `GET /api/v1/subscription` 与 `GET /api/v1/quota`，确认档位能力与订单状态一致。
  3. 模拟支付失败/超时事件，验证订阅状态保持原值且记录失败原因。
  4. 对已是 Plus 的用户触发续费支付，确认权益延长且不会重复扣费。
- **期望**
  - 支付成功 ≤5 s 内完成权益下发，UI 显示成功提示，订单状态 `PAID`。
  - 失败/超时不更改既有档位，订单维持 `PENDING/FAILED` 并提示用户重试。
  - 续费后到期时间延长（`expiresAt` 更新），配额立即刷新。
- **数据**
  - API：`POST /api/v1/payments/checkout`、`POST /api/v1/payments/webhook`、`GET /api/v1/subscription`。
  - 事件：`payment.succeeded`, `payment.failed`。
  - 订单样例编号：`ORD-20240501-0001`。
- **优先级**：P0（Must）
- **关联 UC**：UC-08
- **关联 AC**：AC-FR-090，AC-UC-08
